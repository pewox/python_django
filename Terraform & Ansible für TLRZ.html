<!DOCTYPE html>

<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="mobile-web-app-capable" content="yes">
    <title>
        Terraform &amp; Ansible f√ºr TLRZ - HedgeDoc
    </title>
    <link rel="apple-touch-icon" sizes="180x180" href="https://104705.training.b1-systems.de/notes/icons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://104705.training.b1-systems.de/notes/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://104705.training.b1-systems.de/notes/icons/favicon-16x16.png">
    <link rel="manifest" href="https://104705.training.b1-systems.de/notes/icons/site.webmanifest">
    <link rel="mask-icon" href="https://104705.training.b1-systems.de/notes/icons/safari-pinned-tab.svg" color="#b51f08">
    <link rel="shortcut icon" href="https://104705.training.b1-systems.de/notes/icons/favicon.ico">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.0/css/bootstrap.min.css" integrity="sha256-H0KfTigpUV+0/5tn2HXC0CPwhhDhWgSawJdnFd0CGCo=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fork-awesome/1.1.3/css/fork-awesome.min.css" integrity="sha256-ZhApazu+kejqTYhMF+1DzNKjIzP7KXu6AzyXcC1gMus=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ionicons/2.0.1/css/ionicons.min.css" integrity="sha256-3iu9jgsy9TpTwXKb7bNQzqWekRX7pPK+2OLj3R922fo=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.5.1/themes/prism.min.css" integrity="sha256-vtR0hSWRc3Tb26iuN2oZHt3KRUomwTufNIf5/4oeCyg=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github-gist.min.css" integrity="sha256-tAflq+ymku3Khs+I/WcAneIlafYgDiOQ9stIHH985Wo=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/emojify.js/1.1.0/css/basic/emojify.min.css" integrity="sha256-UOrvMOsSDSrW6szVLe8ZDZezBxh5IoIfgTwdNDgTjiU=" crossorigin="anonymous" />
    <style>
        @import url(https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,400italic,600,600italic,300italic,300|Source+Serif+Pro|Source+Code+Pro:400,300,500&subset=latin,latin-ext);.markdown-body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol;font-size:16px;line-height:1.5;word-wrap:break-word}.markdown-body:after,.markdown-body:before{display:table;content:""}.markdown-body:after{clear:both}.markdown-body>:first-child{margin-top:0!important}.markdown-body>:last-child{margin-bottom:0!important}.markdown-body a:not([href]){color:inherit;text-decoration:none}.markdown-body .absent{color:#c00}.markdown-body .anchor{float:left;padding-right:4px;margin-left:-20px;line-height:1}.markdown-body .anchor:focus{outline:none}.markdown-body blockquote,.markdown-body dl,.markdown-body ol,.markdown-body p,.markdown-body pre,.markdown-body table,.markdown-body ul{margin-top:0;margin-bottom:16px}.markdown-body hr{height:.25em;padding:0;margin:24px 0;background-color:#e7e7e7;border:0}.markdown-body blockquote{padding:0 1em;color:#777;border-left:.25em solid #ddd}.night .markdown-body blockquote{color:#bcbcbc}.markdown-body blockquote>:first-child{margin-top:0}.markdown-body blockquote>:last-child{margin-bottom:0}.markdown-body .loweralpha{list-style-type:lower-alpha}.markdown-body h1,.markdown-body h2,.markdown-body h3,.markdown-body h4,.markdown-body h5,.markdown-body h6{margin-top:24px;margin-bottom:16px;font-weight:600;line-height:1.25}.night .markdown-body h1,.night .markdown-body h2,.night .markdown-body h3,.night .markdown-body h4,.night .markdown-body h5,.night .markdown-body h6{color:#ddd}.markdown-body h1 .fa-link,.markdown-body h2 .fa-link,.markdown-body h3 .fa-link,.markdown-body h4 .fa-link,.markdown-body h5 .fa-link,.markdown-body h6 .fa-link{color:#000;vertical-align:middle;visibility:hidden;font-size:16px}.night .markdown-body h1 .fa-link,.night .markdown-body h2 .fa-link,.night .markdown-body h3 .fa-link,.night .markdown-body h4 .fa-link,.night .markdown-body h5 .fa-link,.night .markdown-body h6 .fa-link{color:#fff}.markdown-body h1:hover .anchor,.markdown-body h2:hover .anchor,.markdown-body h3:hover .anchor,.markdown-body h4:hover .anchor,.markdown-body h5:hover .anchor,.markdown-body h6:hover .anchor{text-decoration:none}.markdown-body h1:hover .anchor .fa-link,.markdown-body h2:hover .anchor .fa-link,.markdown-body h3:hover .anchor .fa-link,.markdown-body h4:hover .anchor .fa-link,.markdown-body h5:hover .anchor .fa-link,.markdown-body h6:hover .anchor .fa-link{visibility:visible}.markdown-body h1 code,.markdown-body h1 tt,.markdown-body h2 code,.markdown-body h2 tt,.markdown-body h3 code,.markdown-body h3 tt,.markdown-body h4 code,.markdown-body h4 tt,.markdown-body h5 code,.markdown-body h5 tt,.markdown-body h6 code,.markdown-body h6 tt{font-size:inherit}.markdown-body h1{font-size:2em}.markdown-body h1,.markdown-body h2{padding-bottom:.3em;border-bottom:1px solid #eee}.markdown-body h2{font-size:1.5em}.markdown-body h3{font-size:1.25em}.markdown-body h4{font-size:1em}.markdown-body h5{font-size:.875em}.markdown-body h6{font-size:.85em;color:#777}.markdown-body ol,.markdown-body ul{padding-left:2em}.markdown-body ol.no-list,.markdown-body ul.no-list{padding:0;list-style-type:none}.markdown-body ol ol,.markdown-body ol ul,.markdown-body ul ol,.markdown-body ul ul{margin-top:0;margin-bottom:0}.markdown-body li>p{margin-top:16px}.markdown-body li+li{margin-top:.25em}.markdown-body dl{padding:0}.markdown-body dl dt{padding:0;margin-top:16px;font-size:1em;font-style:italic;font-weight:700}.markdown-body dl dd{padding:0 16px;margin-bottom:16px}.markdown-body table{display:block;width:100%;overflow:auto;word-break:normal;word-break:keep-all}.markdown-body table th{font-weight:700}.markdown-body table td,.markdown-body table th{padding:6px 13px;border:1px solid #ddd}.markdown-body table tr{background-color:#fff;border-top:1px solid #ccc}.night .markdown-body table tr{background-color:#5f5f5f}.markdown-body table tr:nth-child(2n){background-color:#f8f8f8}.night .markdown-body table tr:nth-child(2n){background-color:#4f4f4f}.markdown-body img{max-width:100%;box-sizing:content-box;background-color:#fff}.markdown-body img[align=right]{padding-left:20px}.markdown-body img[align=left]{padding-right:20px}.markdown-body .emoji{max-width:none;vertical-align:text-top;background-color:transparent}.markdown-body span.frame{display:block;overflow:hidden}.markdown-body span.frame>span{display:block;float:left;width:auto;padding:7px;margin:13px 0 0;overflow:hidden;border:1px solid #ddd}.markdown-body span.frame span img{display:block;float:left}.markdown-body span.frame span span{display:block;padding:5px 0 0;clear:both;color:#333}.markdown-body span.align-center{display:block;overflow:hidden;clear:both}.markdown-body span.align-center>span{display:block;margin:13px auto 0;overflow:hidden;text-align:center}.markdown-body span.align-center span img{margin:0 auto;text-align:center}.markdown-body span.align-right{display:block;overflow:hidden;clear:both}.markdown-body span.align-right>span{display:block;margin:13px 0 0;overflow:hidden;text-align:right}.markdown-body span.align-right span img{margin:0;text-align:right}.markdown-body span.float-left{display:block;float:left;margin-right:13px;overflow:hidden}.markdown-body span.float-left span{margin:13px 0 0}.markdown-body span.float-right{display:block;float:right;margin-left:13px;overflow:hidden}.markdown-body span.float-right>span{display:block;margin:13px auto 0;overflow:hidden;text-align:right}.markdown-body code,.markdown-body tt{padding:.2em 0;margin:0;font-size:85%;background-color:rgba(0,0,0,.04);border-radius:3px}.night .markdown-body code,.night .markdown-body tt{color:#eee;background-color:hsla(0,0%,90.2%,.36)}.markdown-body code:after,.markdown-body code:before,.markdown-body tt:after,.markdown-body tt:before{letter-spacing:-.2em;content:"\00a0"}.markdown-body code br,.markdown-body tt br{display:none}.markdown-body del code{text-decoration:inherit}.markdown-body pre{word-wrap:normal}.markdown-body pre>code{padding:0;margin:0;font-size:100%;word-break:normal;white-space:pre;background:transparent;border:0}.markdown-body .highlight{margin-bottom:16px}.markdown-body .highlight pre{margin-bottom:0;word-break:normal}.markdown-body .highlight pre,.markdown-body pre{padding:16px;overflow:auto;font-size:85%;line-height:1.45;background-color:#f7f7f7;border-radius:3px}.markdown-body pre code,.markdown-body pre tt{display:inline;max-width:auto;padding:0;margin:0;overflow:visible;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}.markdown-body pre code:after,.markdown-body pre code:before,.markdown-body pre tt:after,.markdown-body pre tt:before{content:normal}.markdown-body .csv-data td,.markdown-body .csv-data th{padding:5px;overflow:hidden;font-size:12px;line-height:1;text-align:left;white-space:nowrap}.markdown-body .csv-data .blob-line-num{padding:10px 8px 9px;text-align:right;background:#fff;border:0}.markdown-body .csv-data tr{border-top:0}.markdown-body .csv-data th{font-weight:700;background:#f8f8f8;border-top:0}.markdown-body kbd{display:inline-block;padding:3px 5px;font-size:11px;line-height:10px;color:#555;vertical-align:middle;background-color:#fcfcfc;border:1px solid;border-color:#ccc #ccc #bbb;border-radius:3px;box-shadow:inset 0 -1px 0 #bbb}.news .alert .markdown-body blockquote{padding:0 0 0 40px;border:0}.activity-tab .news .alert .commits,.activity-tab .news .markdown-body blockquote{padding-left:0}.task-list-item{list-style-type:none}.task-list-item label{font-weight:400}.task-list-item.enabled label{cursor:pointer}.task-list-item+.task-list-item{margin-top:3px}.task-list-item-checkbox{float:left;margin:.31em 0 .2em -1.3em!important;vertical-align:middle;cursor:default!important}.markdown-body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol;padding-top:40px;padding-bottom:40px;max-width:758px;overflow:visible!important}.markdown-body pre{border:inherit!important}.night .markdown-body pre{filter:invert(100%)}.markdown-body code{color:inherit!important}.markdown-body pre code .wrapper{display:-webkit-inline-flex;display:-moz-inline-flex;display:-ms-inline-flex;display:-o-inline-flex;display:inline-flex}.markdown-body pre code .gutter{float:left;overflow:hidden;-webkit-user-select:none;user-select:none}.markdown-body pre code .gutter.linenumber{text-align:right;position:relative;display:inline-block;cursor:default;z-index:4;padding:0 8px 0 0;min-width:20px;box-sizing:content-box;color:#afafaf!important;border-right:3px solid #6ce26c!important}.markdown-body pre code .gutter.linenumber>span:before{content:attr(data-linenumber)}.markdown-body pre code .code{float:left;margin:0 0 0 16px}.markdown-body .gist .line-numbers{border-left:none;border-top:none;border-bottom:none}.markdown-body .gist .line-data{border:none}.markdown-body .gist table{border-spacing:0;border-collapse:inherit!important}.night .markdown-body .gist table tr:nth-child(2n){background-color:#ddd}.night .markdown-body .gist table tr:nth-child(odd){background-color:#e3e3e3}.markdown-body code[data-gist-id]{background:none;padding:0;filter:invert(100%)}.markdown-body code[data-gist-id]:after,.markdown-body code[data-gist-id]:before{content:""}.markdown-body code[data-gist-id] .blob-num{border:unset}.markdown-body code[data-gist-id] table{overflow:unset;margin-bottom:unset}.markdown-body code[data-gist-id] table tr{background:unset}.markdown-body[dir=rtl] pre{direction:ltr}.markdown-body[dir=rtl] code{direction:ltr;unicode-bidi:embed}.markdown-body .alert>p{margin-bottom:0}.markdown-body pre.abc,.markdown-body pre.flow-chart,.markdown-body pre.graphviz,.markdown-body pre.mermaid,.markdown-body pre.sequence-diagram{text-align:center;background-color:inherit;border-radius:0;white-space:inherit}.night .markdown-body pre.graphviz{filter:none}.night .markdown-body pre.mermaid .sectionTitle,.night .markdown-body pre.mermaid .titleText,.night .markdown-body pre.mermaid text{fill:#fff}.markdown-body pre.abc>code,.markdown-body pre.flow-chart>code,.markdown-body pre.graphviz>code,.markdown-body pre.mermaid>code,.markdown-body pre.sequence-diagram>code{text-align:left}.markdown-body pre.abc>svg,.markdown-body pre.flow-chart>svg,.markdown-body pre.graphviz>svg,.markdown-body pre.mermaid>svg,.markdown-body pre.sequence-diagram>svg{max-width:100%;height:100%}.night .markdown-body .abc{background-color:#fff;filter:none}.night pre rect{fill:transparent}.markdown-body pre>code.wrap{white-space:pre-wrap;white-space:-moz-pre-wrap;white-space:-pre-wrap;white-space:-o-pre-wrap;word-wrap:break-word}.markdown-body .alert>p,.markdown-body .alert>ul{margin-bottom:0}.markdown-body summary{display:list-item}.markdown-body summary:focus{outline:none}.markdown-body details summary{cursor:pointer}.markdown-body details:not([open])>:not(summary){display:none}.markdown-body figure{margin:1em 40px}.markdown-body img{background-color:transparent}.vimeo,.youtube{cursor:pointer;display:table;text-align:center;background-position:50%;background-repeat:no-repeat;background-size:contain;background-color:#000;overflow:hidden}.vimeo,.youtube{position:relative;width:100%}.youtube{padding-bottom:56.25%}.vimeo img{width:100%;object-fit:contain;z-index:0}.youtube img{object-fit:cover;z-index:0}.vimeo iframe,.youtube iframe,.youtube img{width:100%;height:100%;position:absolute;top:0;left:0}.vimeo iframe,.youtube iframe{vertical-align:middle;z-index:1}.vimeo .icon,.youtube .icon{position:absolute;height:auto;width:auto;top:50%;left:50%;transform:translate(-50%,-50%);color:#fff;opacity:.3;-webkit-transition:opacity .2s;transition:opacity .2s;z-index:0}.vimeo:hover .icon,.youtube:hover .icon{opacity:.6;-webkit-transition:opacity .2s;transition:opacity .2s}.slideshare .inner,.speakerdeck .inner{position:relative;width:100%}.slideshare .inner iframe,.speakerdeck .inner iframe{position:absolute;top:0;bottom:0;left:0;right:0;width:100%;height:100%}.MJX_Assistive_MathML{display:none}.ui-infobar{position:relative;z-index:2;max-width:758px;margin-top:25px;margin-bottom:-25px;color:#777}.toc .invisable-node{list-style-type:none}.ui-toc{position:fixed;bottom:20px;z-index:10000}.ui-toc-label{opacity:.3;background-color:#ccc;border:none}.ui-toc-label,.ui-toc .open .ui-toc-label{-webkit-transition:opacity .2s;transition:opacity .2s}.ui-toc .open .ui-toc-label{opacity:1;color:#fff}.ui-toc-label:focus{opacity:.3;background-color:#ccc;color:#000}.ui-toc-label:hover{opacity:1;background-color:#ccc;-webkit-transition:opacity .2s;transition:opacity .2s}.ui-toc-dropdown{margin-top:23px;margin-bottom:20px;padding-left:10px;padding-right:10px;max-width:45vw;width:25vw;max-height:70vh;overflow:auto;text-align:inherit}.ui-toc-dropdown>.toc{max-height:calc(70vh - 100px);overflow:auto}.ui-toc-dropdown[dir=rtl] .nav{padding-right:0;letter-spacing:.0029em}.ui-toc-dropdown a{overflow:hidden;text-overflow:ellipsis;white-space:pre}.ui-toc-dropdown .nav>li>a{display:block;padding:4px 20px;font-size:13px;font-weight:500;color:#767676}.ui-toc-dropdown .nav>li:first-child:last-child>ul,.ui-toc-dropdown .toc.expand ul{display:block}.ui-toc-dropdown .nav>li>a:focus,.ui-toc-dropdown .nav>li>a:hover{padding-left:19px;color:#000;text-decoration:none;background-color:transparent;border-left:1px solid #000}.night .ui-toc-dropdown .nav>li>a:focus,.night .ui-toc-dropdown .nav>li>a:hover{color:#fff;border-left-color:#fff}.ui-toc-dropdown[dir=rtl] .nav>li>a:focus,.ui-toc-dropdown[dir=rtl] .nav>li>a:hover{padding-right:19px;border-left:none;border-right:1px solid #000}.ui-toc-dropdown .nav>.active:focus>a,.ui-toc-dropdown .nav>.active:hover>a,.ui-toc-dropdown .nav>.active>a{padding-left:18px;font-weight:700;color:#000;background-color:transparent;border-left:2px solid #000}.night .ui-toc-dropdown .nav>.active:focus>a,.night .ui-toc-dropdown .nav>.active:hover>a,.night .ui-toc-dropdown .nav>.active>a{color:#fff;border-left:2px solid #fff}.ui-toc-dropdown[dir=rtl] .nav>.active:focus>a,.ui-toc-dropdown[dir=rtl] .nav>.active:hover>a,.ui-toc-dropdown[dir=rtl] .nav>.active>a{padding-right:18px;border-left:none;border-right:2px solid #000}.ui-toc-dropdown .nav .nav{display:none;padding-bottom:10px}.ui-toc-dropdown .nav>.active>ul{display:block}.ui-toc-dropdown .nav .nav>li>a{padding-top:1px;padding-bottom:1px;padding-left:30px;font-size:12px;font-weight:400}.night .ui-toc-dropdown .nav>li>a{color:#aaa}.ui-toc-dropdown[dir=rtl] .nav .nav>li>a{padding-right:30px}.ui-toc-dropdown .nav .nav>li>ul>li>a{padding-top:1px;padding-bottom:1px;padding-left:40px;font-size:12px;font-weight:400}.ui-toc-dropdown[dir=rtl] .nav .nav>li>ul>li>a{padding-right:40px}.ui-toc-dropdown .nav .nav>li>a:focus,.ui-toc-dropdown .nav .nav>li>a:hover{padding-left:29px}.ui-toc-dropdown[dir=rtl] .nav .nav>li>a:focus,.ui-toc-dropdown[dir=rtl] .nav .nav>li>a:hover{padding-right:29px}.ui-toc-dropdown .nav .nav>li>ul>li>a:focus,.ui-toc-dropdown .nav .nav>li>ul>li>a:hover{padding-left:39px}.ui-toc-dropdown[dir=rtl] .nav .nav>li>ul>li>a:focus,.ui-toc-dropdown[dir=rtl] .nav .nav>li>ul>li>a:hover{padding-right:39px}.ui-toc-dropdown .nav .nav>.active:focus>a,.ui-toc-dropdown .nav .nav>.active:hover>a,.ui-toc-dropdown .nav .nav>.active>a{padding-left:28px;font-weight:500}.ui-toc-dropdown[dir=rtl] .nav .nav>.active:focus>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active:hover>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active>a{padding-right:28px}.ui-toc-dropdown .nav .nav>.active>.nav>.active:focus>a,.ui-toc-dropdown .nav .nav>.active>.nav>.active:hover>a,.ui-toc-dropdown .nav .nav>.active>.nav>.active>a{padding-left:38px;font-weight:500}.ui-toc-dropdown[dir=rtl] .nav .nav>.active>.nav>.active:focus>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active>.nav>.active:hover>a,.ui-toc-dropdown[dir=rtl] .nav .nav>.active>.nav>.active>a{padding-right:38px}.markdown-body[lang^=ja]{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Helvetica,Arial,Hiragino Kaku Gothic Pro,„Éí„É©„ÇÆ„ÉéËßí„Ç¥ Pro W3,Osaka,Meiryo,„É°„Ç§„É™„Ç™,MS Gothic,Ôº≠Ôº≥ „Ç¥„Ç∑„ÉÉ„ÇØ,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol}.ui-toc-dropdown[lang^=ja]{font-family:Source Sans Pro,Helvetica,Arial,Meiryo UI,MS PGothic,Ôº≠Ôº≥ Ôº∞„Ç¥„Ç∑„ÉÉ„ÇØ,sans-serif}.markdown-body[lang=zh-tw]{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Helvetica,Arial,PingFang TC,Microsoft JhengHei,ÂæÆËªüÊ≠£Èªë,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol}.ui-toc-dropdown[lang=zh-tw]{font-family:Source Sans Pro,Helvetica,Arial,Microsoft JhengHei UI,ÂæÆËªüÊ≠£ÈªëUI,sans-serif}.markdown-body[lang=zh-cn]{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Helvetica,Arial,PingFang SC,Microsoft YaHei,ÂæÆËΩØÈõÖÈªë,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol}.ui-toc-dropdown[lang=zh-cn]{font-family:Source Sans Pro,Helvetica,Arial,Microsoft YaHei UI,ÂæÆËΩØÈõÖÈªëUI,sans-serif}.ui-affix-toc{position:fixed;top:0;max-width:15vw;max-height:70vh;overflow:auto}.back-to-top,.expand-toggle,.go-to-bottom{display:block;padding:4px 10px;margin-top:10px;margin-left:10px;font-size:12px;font-weight:500;color:#999}.back-to-top:focus,.back-to-top:hover,.expand-toggle:focus,.expand-toggle:hover,.go-to-bottom:focus,.go-to-bottom:hover{color:#563d7c;text-decoration:none}.back-to-top,.go-to-bottom{margin-top:0}.ui-user-icon{width:20px;height:20px;display:block;border-radius:3px;margin-top:2px;margin-bottom:2px;margin-right:5px;background-position:50%;background-repeat:no-repeat;background-size:contain}.ui-user-icon.small{width:18px;height:18px;display:inline-block;vertical-align:middle;margin:0 0 .2em}small span{line-height:22px}small .dropdown{display:inline-block}small .dropdown a:focus,small .dropdown a:hover{text-decoration:none}.unselectable{-moz-user-select:none;-khtml-user-select:none;-webkit-user-select:none;-o-user-select:none;user-select:none}.night .navbar{background:#333;border-bottom-color:#333;color:#eee}.night .navbar a{color:#eee}.markdown-body h1[id]:before,.markdown-body h2[id]:before,.markdown-body h3[id]:before,.markdown-body h4[id]:before,.markdown-body h5[id]:before,.markdown-body h6[id]:before{display:block;content:" ";margin-top:-55px;height:55px;visibility:hidden}@media print{blockquote,div,img,pre,table{page-break-inside:avoid!important}a[href]:after{font-size:12px!important}}.markdown-body.slides{position:relative;z-index:1;color:#222}.markdown-body.slides:before{content:"";display:block;position:absolute;top:0;left:0;right:0;bottom:0;z-index:-1;background-color:currentColor;box-shadow:0 0 0 50vw}.markdown-body.slides section[data-markdown]{position:relative;margin-bottom:1.5em;background-color:#fff;text-align:center}.markdown-body.slides section[data-markdown] code{text-align:left}.markdown-body.slides section[data-markdown]:before{content:"";display:block;padding-bottom:56.23%}.markdown-body.slides section[data-markdown]>div:first-child{position:absolute;top:50%;left:1em;right:1em;transform:translateY(-50%);max-height:100%;overflow:hidden}.markdown-body.slides section[data-markdown]>ul{display:inline-block}.markdown-body.slides>section>section+section:after{content:"";position:absolute;top:-1.5em;right:1em;height:1.5em;border:3px solid #777}.markdown-body.slides aside.notes{display:none}.markdown-body.slides ol,.markdown-body.slides ul{display:inline-block;text-align:left;margin:0 0 0 1em;padding:0}.markdown-body.slides table{width:50%;margin:0 auto;border-collapse:collapse;border-spacing:0;display:table}.markdown-body.slides table td,.markdown-body.slides table th{text-align:left;padding:.2em .5em;border:none;border-bottom:1px solid}.markdown-body.slides table tr{border-top:0;background-color:#fff}.markdown-body.slides table tr:nth-child(2n){background-color:inherit}.markdown-body.slides table tbody tr:last-child td,.markdown-body.slides table tbody tr:last-child th{border-bottom:none}.markdown-body.slides h1,.markdown-body.slides h2{border-bottom:0}.night .markdown-body.slides h1,.night .markdown-body.slides h2,.night .markdown-body.slides h3,.night .markdown-body.slides h4,.night .markdown-body.slides h5,.night .markdown-body.slides h6{color:#000}.markdown-body section>section:last-child{margin-bottom:1.5em!important}.ui-view-area.black{background-color:#000!important}body{font-smoothing:subpixel-antialiased!important;-webkit-font-smoothing:subpixel-antialiased!important;-moz-osx-font-smoothing:auto!important;text-shadow:0 0 1em transparent,1px 1px 1.2px rgba(0,0,0,.004);-webkit-overflow-scrolling:touch;font-family:Source Sans Pro,Helvetica,Arial,sans-serif;letter-spacing:.025em}.focus,:focus{outline:none!important}::-moz-focus-inner{border:0!important}body.modal-open{overflow-y:auto;padding-right:0!important}
    </style>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    	<script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js" integrity="sha256-3Jy/GbSLrg0o9y5Z5n1uw0qxZECH7C6OQpVBgNFYa0g=" crossorigin="anonymous"></script>
    	<script src="https://cdnjs.cloudflare.com/ajax/libs/respond.js/1.4.2/respond.min.js" integrity="sha256-g6iAfvZp+nDQ2TdTR/VVKJf3bGro4ub5fvWSWVRi2NE=" crossorigin="anonymous"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/es5-shim/4.5.9/es5-shim.min.js" integrity="sha256-8E4Is26QH0bD52WoQpcB+R/tcWQtpzlCojrybUd7Mxo=" crossorigin="anonymous"></script>
    <![endif]-->
</head>

<body translate="no">
    <div id="doc" class="markdown-body container-fluid"><h1 id="Terraform-amp-Ansible-f√ºr-TLRZ"><a class="anchor hidden-xs" href="#Terraform-amp-Ansible-f√ºr-TLRZ" title="Terraform-amp-Ansible-f√ºr-TLRZ"><i class="fa fa-link"></i></a>Terraform &amp; Ansible f√ºr TLRZ</h1><h2 id="Trainer"><a class="anchor hidden-xs" href="#Trainer" title="Trainer"><i class="fa fa-link"></i></a>Trainer:</h2><p>Markus Schmidt-Pauly<br>
B1 Systems GmbH<br>
<a href="mailto:schmidt-pauly@b1-systems.de" target="_blank" rel="noopener">schmidt-pauly@b1-systems.de</a></p><h2 id="Schulungsumgebung"><a class="anchor hidden-xs" href="#Schulungsumgebung" title="Schulungsumgebung"><i class="fa fa-link"></i></a>Schulungsumgebung</h2><h3 id="Zugriff-√ºber-Web-RDP-Guacamole"><a class="anchor hidden-xs" href="#Zugriff-√ºber-Web-RDP-Guacamole" title="Zugriff-√ºber-Web-RDP-Guacamole"><i class="fa fa-link"></i></a>Zugriff √ºber Web-RDP (Guacamole):</h3><p><a href="https://104705.training.b1-systems.de" target="_blank" rel="noopener">https://104705.training.b1-systems.de</a></p><h3 id="Zugriff-√ºber-SSH"><a class="anchor hidden-xs" href="#Zugriff-√ºber-SSH" title="Zugriff-√ºber-SSH"><i class="fa fa-link"></i></a>Zugriff √ºber SSH:</h3><p>ssh user[x]@104705.training.b1-systems.de</p><h3 id="Zugriff-vom-Jumphost-auf-die-einzelnen-Maschinen"><a class="anchor hidden-xs" href="#Zugriff-vom-Jumphost-auf-die-einzelnen-Maschinen" title="Zugriff-vom-Jumphost-auf-die-einzelnen-Maschinen"><i class="fa fa-link"></i></a>Zugriff vom Jumphost auf die einzelnen Maschinen:</h3><p>ssh tux@ansible-[userid]</p><p>[user1] Andre<br>
guacamole_password=Lr60M3JLiJ<br>
ansible-1=100.80.4.152<br>
debian1-1=100.80.1.100<br>
debian2-1=100.80.4.11<br>
redhat1-1=100.80.1.149<br>
redhat2-1=100.80.2.83<br>
suse1-1=100.80.1.108<br>
suse2-1=100.80.1.61<br>
ubuntu1-1=100.80.4.70<br>
ubuntu2-1=100.80.2.24</p><p>[user2] Benjamin<br>
guacamole_password=5WMqrbcMtb<br>
ansible-2=100.80.3.6<br>
debian1-2=100.80.2.11<br>
debian2-2=100.80.3.93<br>
redhat1-2=100.80.0.228<br>
redhat2-2=100.80.1.85<br>
suse1-2=100.80.2.219<br>
suse2-2=100.80.4.139<br>
ubuntu1-2=100.80.4.16<br>
ubuntu2-2=100.80.1.87</p><p>[user3] Bj√∂rn<br>
guacamole_password=Ap48A9TL0b<br>
ansible-3=100.80.2.123<br>
debian1-3=100.80.4.78<br>
debian2-3=100.80.0.233<br>
redhat1-3=100.80.3.33<br>
redhat2-3=100.80.3.165<br>
suse1-3=100.80.1.49<br>
suse2-3=100.80.3.209<br>
ubuntu1-3=100.80.2.112<br>
ubuntu2-3=100.80.0.50</p><p>[user4] Florian<br>
guacamole_password=x5VxqbvdTd<br>
ansible-4=100.80.2.221<br>
debian1-4=100.80.2.1<br>
debian2-4=100.80.2.117<br>
redhat1-4=100.80.0.67<br>
redhat2-4=100.80.4.61<br>
suse1-4=100.80.0.22<br>
suse2-4=100.80.0.38<br>
ubuntu1-4=100.80.2.31<br>
ubuntu2-4=100.80.2.90</p><p>[user5] Michaela<br>
guacamole_password=xV5FCWI9jz<br>
ansible-5=100.80.1.167<br>
debian1-5=100.80.2.206<br>
debian2-5=100.80.3.166<br>
redhat1-5=100.80.1.1<br>
redhat2-5=100.80.4.140<br>
suse1-5=100.80.3.7<br>
suse2-5=100.80.4.148<br>
ubuntu1-5=100.80.4.163<br>
ubuntu2-5=100.80.1.175</p><p>[user6] Thorsten<br>
guacamole_password=k4rD5EGgZO<br>
ansible-6=100.80.3.81<br>
debian1-6=100.80.0.32<br>
debian2-6=100.80.0.195<br>
redhat1-6=100.80.1.113<br>
redhat2-6=100.80.3.194<br>
suse1-6=100.80.2.178<br>
suse2-6=100.80.2.218<br>
ubuntu1-6=100.80.2.6<br>
ubuntu2-6=100.80.1.190</p><p>[user7] Jacob<br>
guacamole_password=4iYTILlJzs<br>
ansible-7=100.80.4.66<br>
debian1-7=100.80.4.1<br>
debian2-7=100.80.1.115<br>
redhat1-7=100.80.1.242<br>
redhat2-7=100.80.4.206<br>
suse1-7=100.80.3.121<br>
suse2-7=100.80.1.171<br>
ubuntu1-7=100.80.0.100<br>
ubuntu2-7=100.80.4.153</p><p>[user8] Jan<br>
guacamole_password=q2PLNV0PIx<br>
ansible-8=100.80.4.146<br>
debian1-8=100.80.1.251<br>
debian2-8=100.80.4.108<br>
redhat1-8=100.80.1.14<br>
redhat2-8=100.80.0.245<br>
suse1-8=100.80.4.129<br>
suse2-8=100.80.1.55<br>
ubuntu1-8=100.80.1.25<br>
ubuntu2-8=100.80.0.57</p><p>[user9] J√ºrgen<br>
guacamole_password=CnW525f3j4<br>
ansible-9=100.80.2.143<br>
debian1-9=100.80.4.74<br>
debian2-9=100.80.3.26<br>
redhat1-9=100.80.2.137<br>
redhat2-9=100.80.3.232<br>
suse1-9=100.80.2.108<br>
suse2-9=100.80.1.116<br>
ubuntu1-9=100.80.1.199<br>
ubuntu2-9=100.80.3.159</p><p>[user10] Mario<br>
guacamole_password=8nZtbuSw1T<br>
ansible-10=100.80.3.126<br>
debian1-10=100.80.2.45<br>
debian2-10=100.80.1.70<br>
redhat1-10=100.80.1.92<br>
redhat2-10=100.80.2.209<br>
suse1-10=100.80.1.234<br>
suse2-10=100.80.2.229<br>
ubuntu1-10=100.80.1.97<br>
ubuntu2-10=100.80.4.52</p><p>[user11] Matthias<br>
guacamole_password=Xg02IcnTL5<br>
ansible-11=100.80.0.193<br>
debian1-11=100.80.4.116<br>
debian2-11=100.80.1.232<br>
redhat1-11=100.80.4.80<br>
redhat2-11=100.80.2.56<br>
suse1-11=100.80.2.142<br>
suse2-11=100.80.0.215<br>
ubuntu1-11=100.80.3.221<br>
ubuntu2-11=100.80.1.53</p><p>[user12] Peter<br>
guacamole_password=u0CKDbVd55<br>
ansible-12=100.80.1.106<br>
debian1-12=100.80.2.150<br>
debian2-12=100.80.4.46<br>
redhat1-12=100.80.1.67<br>
redhat2-12=100.80.3.74<br>
suse1-12=100.80.3.17<br>
suse2-12=100.80.2.15<br>
ubuntu1-12=100.80.2.167<br>
ubuntu2-12=100.80.0.172</p><p>[user13] Sebastian<br>
guacamole_password=o2uGOWtuhU<br>
ansible-13=100.80.3.69<br>
debian1-13=100.80.2.127<br>
debian2-13=100.80.0.112<br>
redhat1-13=100.80.2.30<br>
redhat2-13=100.80.4.141<br>
suse1-13=100.80.4.137<br>
suse2-13=100.80.2.2<br>
ubuntu1-13=100.80.1.73<br>
ubuntu2-13=100.80.0.14</p><h1 id="Tag-1"><a class="anchor hidden-xs" href="#Tag-1" title="Tag-1"><i class="fa fa-link"></i></a>Tag 1</h1><h1 id="Terraform0"><a class="anchor hidden-xs" href="#Terraform0" title="Terraform0"><i class="fa fa-link"></i></a>Terraform</h1><h2 id="Installation"><a class="anchor hidden-xs" href="#Installation" title="Installation"><i class="fa fa-link"></i></a>Installation</h2><h3 id="Repo-einrichten-Debian"><a class="anchor hidden-xs" href="#Repo-einrichten-Debian" title="Repo-einrichten-Debian"><i class="fa fa-link"></i></a>Repo einrichten (Debian)</h3><pre><code>sudo -i
wget -O- https://apt.releases.hashicorp.com/gpg | gpg --dearmor | sudo tee /usr/share/keyrings/hashicorp-archive-keyring.gpg
echo "deb [signed-by=/usr/share/keyrings/hashicorp-archive-keyring.gpg] https://apt.releases.hashicorp.com $(lsb_release -cs) main" | sudo tee /etc/apt/sources.list.d/hashicorp.list
</code></pre><h3 id="Terraform-installieren"><a class="anchor hidden-xs" href="#Terraform-installieren" title="Terraform-installieren"><i class="fa fa-link"></i></a>Terraform installieren</h3><pre><code>apt update
apt install terraform
</code></pre><h2 id="Projekt-initialisieren"><a class="anchor hidden-xs" href="#Projekt-initialisieren" title="Projekt-initialisieren"><i class="fa fa-link"></i></a>Projekt initialisieren</h2><p>Zuerst legen wir uns (als User tux!) ein Verzeichnis an:</p><pre><code>cd
mkdir terraform
cd terraform
mkdir project1
cd project1
</code></pre><p>In diesem Verzeichnis legen wir uns die Konfiguration f√ºr Terraform an:</p><pre><code>vi versions.tf
</code></pre><p>Inhalt der Datei:</p><pre><code>terraform {
  required_providers {
    openstack = {
      source = "terraform-provider-openstack/openstack"
    }
  }
  required_version = "&gt;= 0.13"
}
</code></pre><h2 id="Provider-konfigurieren"><a class="anchor hidden-xs" href="#Provider-konfigurieren" title="Provider-konfigurieren"><i class="fa fa-link"></i></a>Provider konfigurieren</h2><p>Es wird eine neue Datei <a href="http://provider.tf" target="_blank" rel="noopener">provider.tf</a> im Workspace angelegt. Inhalt:</p><pre><code>provider "openstack" {
  auth_url            = "https://fra1.citycloud.com:5000/v3.0"
  user_name           = "b1terraform-training"
  password            = "pCEkIrITPwEW38QVFz8n"
  region              = "Fra1"
  tenant_name         = "training-terraform-sandbox"
  project_domain_name = "CCP_Domain_38213"
  user_domain_name    = "CCP_Domain_38213"
}
</code></pre><h2 id="Eine-erste-Resource-VM"><a class="anchor hidden-xs" href="#Eine-erste-Resource-VM" title="Eine-erste-Resource-VM"><i class="fa fa-link"></i></a>Eine erste Resource (VM):</h2><p>neue Datei: <a href="http://server.tf" target="_blank" rel="noopener">server.tf</a></p><pre><code>resource "openstack_compute_instance_v2" "msp-vm" {
  name        = "MSP Server"
  image_name  = "Debian 12 Bookworm x86_64"
  flavor_name = "1C-1GB-20GB"
  network {
    name = "net-to-external"
  }
}
</code></pre><h3 id="Erweiterung-auf-3-gleiche-VMs"><a class="anchor hidden-xs" href="#Erweiterung-auf-3-gleiche-VMs" title="Erweiterung-auf-3-gleiche-VMs"><i class="fa fa-link"></i></a>Erweiterung auf 3 gleiche VMs</h3><pre><code>resource "openstack_compute_instance_v2" "msp-vm" {
  name        = "MSP Server ${count.index + 1}"
  image_name  = "Debian 12 Bookworm x86_64"
  flavor_name = "1C-1GB-20GB"
  count       = 3
  network {
    name = "net-to-external"
  }
}
</code></pre><h3 id="Netzwerk-und-Subnet"><a class="anchor hidden-xs" href="#Netzwerk-und-Subnet" title="Netzwerk-und-Subnet"><i class="fa fa-link"></i></a>Netzwerk und Subnet</h3><p>neue Datei: <a href="http://network.tf" target="_blank" rel="noopener">network.tf</a></p><pre><code>resource "openstack_networking_network_v2" "msp-net" {
  name           = "MSP Network"
  admin_state_up = true
}

resource "openstack_networking_subnet_v2" "msp-subnet" {
  name       = "MSP Subnet"
  ip_version = 4
  cidr       = "192.168.42.0/24"
  network_id = openstack_networking_network_v2.msp-net.id
}
</code></pre><p>Um das Netzwerk mit den Servern zu verbinden m√ºssen wir die <a href="http://server.tf" target="_blank" rel="noopener">server.tf</a> anpassen:</p><pre><code>resource "openstack_compute_instance_v2" "msp-vm" {
  name        = "MSP Server ${count.index + 1}"
  image_name  = "Debian 12 Bookworm x86_64"
  flavor_name = "1C-1GB-20GB"
  count       = 3
  network {
    uuid = openstack_networking_network_v2.msp-net.id
  }
}
</code></pre><h3 id="Erweiterung-um-Router-und-Floatingip"><a class="anchor hidden-xs" href="#Erweiterung-um-Router-und-Floatingip" title="Erweiterung-um-Router-und-Floatingip"><i class="fa fa-link"></i></a>Erweiterung um Router und Floatingip</h3><pre><code>resource "openstack_networking_network_v2" "msp-net" {
  name           = "MSP Network"
  admin_state_up = true
}

resource "openstack_networking_subnet_v2" "msp-subnet" {
  name       = "MSP Subnet"
  ip_version = 4
  cidr       = "192.168.42.0/24"
  network_id = openstack_networking_network_v2.msp-net.id
}

resource "openstack_networking_router_v2" "msp-router" {
  name                = "MSP Router"
  admin_state_up      = true
  external_network_id = data.openstack_networking_network_v2.external-net.id
}

resource "openstack_networking_router_interface_v2" "msp-interface" {
  router_id = openstack_networking_router_v2.msp-router.id
  subnet_id = openstack_networking_subnet_v2.msp-subnet.id
}

data "openstack_networking_network_v2" "external-net" {
  name = "ext-net"
}

resource "openstack_networking_floatingip_v2" "msp-float" {
  pool = "ext-net"
}

resource "openstack_compute_floatingip_associate_v2" "msp-fip-ass" {
  floating_ip = openstack_networking_floatingip_v2.msp-float.address
  instance_id = openstack_compute_instance_v2.msp-vm.0.id
}
</code></pre><h3 id="Keypair-erzeugen"><a class="anchor hidden-xs" href="#Keypair-erzeugen" title="Keypair-erzeugen"><i class="fa fa-link"></i></a>Keypair erzeugen</h3><pre><code>cd
ssh-keygen
</code></pre><p>Fragen einfach mit (enter) durchwinken<br>
Public Key holen:</p><pre><code>cat .ssh/id_rsa.pub
</code></pre><h3 id="Server-mit-keypair-erweitern"><a class="anchor hidden-xs" href="#Server-mit-keypair-erweitern" title="Server-mit-keypair-erweitern"><i class="fa fa-link"></i></a>Server mit keypair erweitern</h3><p><a href="http://server.tf" target="_blank" rel="noopener">server.tf</a>:</p><pre><code>resource "openstack_compute_instance_v2" "msp-vm" {
  name        = "MSP Server ${count.index + 1}"
  image_name  = "Debian 12 Bookworm x86_64"
  flavor_name = "1C-1GB-20GB"
  count       = 3
  key_pair    = "MSP"
  network {
    uuid = openstack_networking_network_v2.msp-net.id
  }
}

resource "openstack_compute_keypair_v2" "msp-key" {
  name       = "MSP"
  public_key = "(Das Ergebnis vom cat-Befehl OHNE tux@ansible...)"
}
</code></pre><h1 id="Tag-2"><a class="anchor hidden-xs" href="#Tag-2" title="Tag-2"><i class="fa fa-link"></i></a>Tag 2</h1><h2 id="Variablen"><a class="anchor hidden-xs" href="#Variablen" title="Variablen"><i class="fa fa-link"></i></a>Variablen</h2><p>neue Datei: <a href="http://variables.tf" target="_blank" rel="noopener">variables.tf</a></p><pre><code>variable "flavor" {}

variable "vmcount" {}

variable "cidr" {}
</code></pre><p>neue Datei: terraform.tfvars</p><pre><code>flavor  = "1C-1GB-20GB"
vmcount = 2
cidr    = "192.168.42.0/24"
</code></pre><p>Anpassung <a href="http://server.tf" target="_blank" rel="noopener">server.tf</a> (Ausschnitt)</p><pre><code>resource "openstack_compute_instance_v2" "msp-vm" {
  name        = "MSP Server ${count.index + 1}"
  image_name  = "Debian 12 Bookworm x86_64"
  flavor_name = var.flavor
  count       = var.vmcount
  key_pair    = "MSP"
  network {
    uuid = openstack_networking_network_v2.msp-net.id
  }
}
</code></pre><p>Anpassung <a href="http://network.tf" target="_blank" rel="noopener">network.tf</a> (Ausschnitt)</p><pre><code>resource "openstack_networking_subnet_v2" "msp-subnet" {
  name       = "MSP Subnet"
  ip_version = 4
  cidr       = var.cidr
  network_id = openstack_networking_network_v2.msp-net.id
}
</code></pre><h2 id="Outputs"><a class="anchor hidden-xs" href="#Outputs" title="Outputs"><i class="fa fa-link"></i></a>Outputs</h2><p>neue Datei: <a href="http://outputs.tf" target="_blank" rel="noopener">outputs.tf</a></p><pre><code>output "floating-IP" {
  value = openstack_networking_floatingip_v2.msp-float.address
}

output "server-ips" {
  value = openstack_compute_instance_v2.msp-vm.*.network.0.fixed_ip_v4
}
</code></pre><h2 id="Blockstorage"><a class="anchor hidden-xs" href="#Blockstorage" title="Blockstorage"><i class="fa fa-link"></i></a>Blockstorage</h2><p>Erg√§nzung in der <a href="http://server.tf" target="_blank" rel="noopener">server.tf</a></p><pre><code>resource "openstack_blockstorage_volume_v3" "msp-volume" {
  name  = "MSP Volume"
  size  = 3
  count = var.vmcount
}

resource "openstack_compute_volume_attach_v2" "msp-vol-att" {
  instance_id = openstack_compute_instance_v2.msp-vm[count.index].id
  volume_id   = openstack_blockstorage_volume_v3.msp-volume[count.index].id
  count       = var.vmcount
}
</code></pre><h2 id="Null-Resource-remote-und-local-exec"><a class="anchor hidden-xs" href="#Null-Resource-remote-und-local-exec" title="Null-Resource-remote-und-local-exec"><i class="fa fa-link"></i></a>Null Resource (remote und local-exec)</h2><p>neue Datei: <a href="http://null.tf" target="_blank" rel="noopener">null.tf</a></p><pre><code>resource "null_resource" "remote-command" {
  depends_on = [openstack_compute_floatingip_associate_v2.msp-fip-ass]

  provisioner "remote-exec" {
    inline = ["echo 'ich bin ein remote provisioner' &gt; /tmp/provisioner.txt"]
    connection {
      type        = "ssh"
      user        = "debian"
      private_key = file("/home/tux/.ssh/id_rsa")
      #     private_key = file("/root/.ssh/id_rsa")   &lt;== f√ºr diejenigen, die mit root arbeiten
      host = openstack_compute_floatingip_associate_v2.msp-fip-ass.floating_ip
    }
  }
}

resource "null_resource" "local-command" {
  depends_on = [openstack_compute_instance_v2.msp-vm]
  provisioner "local-exec" {
    command = "echo '${openstack_compute_instance_v2.msp-vm.0.access_ip_v4}' &gt; ips.txt"
  }
}
</code></pre><h2 id="Module"><a class="anchor hidden-xs" href="#Module" title="Module"><i class="fa fa-link"></i></a>Module</h2><h3 id="Vorbereitung"><a class="anchor hidden-xs" href="#Vorbereitung" title="Vorbereitung"><i class="fa fa-link"></i></a>Vorbereitung:</h3><p>Als der User, mit dem ihr arbeitet:</p><pre><code>cd ~/terraform
mkdir workspace
mv project1 workspace
mkdir modules
cd modules
mkdir jumphost
cd jumphost
</code></pre><h3 id="Modul"><a class="anchor hidden-xs" href="#Modul" title="Modul"><i class="fa fa-link"></i></a>Modul</h3><p><a href="http://main.tf" target="_blank" rel="noopener">main.tf</a>:</p><pre><code>variable "jumphost_flavor" {
}

variable "jumphost_port_id" {
}

resource "openstack_compute_instance_v2" "jumphost-msp-vm" {
  name        = "MSP Jumphost"
  image_name  = "Debian 12 Bookworm x86_64"
  flavor_name = var.jumphost_flavor
  key_pair    = "MSPjump"
  network {
    name = "net-to-external"
  }
  network {
    port = var.jumphost_port_id
  }
}

resource "openstack_compute_keypair_v2" "jumphost-msp-key" {
  name       = "MSPjump"
  public_key = "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDPI5nnVAffaClCbkX0yhfHnB+tBg5jKMVwXTjLByzIk6HTtQPnocltv2+0HC3eFkbVs4zq/XeUS6riBXbT9HKmzz3853vh19K9G8wVRNxJZmvWNdZ1c/+pApcVOGm+/OBhivFg+U4727KDONqJgpD4X3QjfrLsK8w3dXLevzZxDNxJgiNzK7gOVIqunTINceIDybSjHgllhepeIGmHhf4qv6zoNfClJtmLWulYZh0NRiMApILq0sN7t30jFXHB9Kyxctumst7lVn0E9ovjpAXiiYeIkFyIZAcQf4OGlqbAj+5Octis4msDpc+wHhOiq+LAxPnxmsFfsiWL94CbeUgsKRUTjiY1sRyWTFD6YNln0yHaZzxUD3toMeq2Xft+8zKleb5IgS+kuDrL8HZnRvN5pI2CvcwNwTMydmcivXZg8U21z1cuBUReitL+JwzTU/OkDyUg9ZMBuvm7CfXLSH9T/Mwsrlsd5HvPuoSaD5dqEz7v4dnUyP79nw82gSFCofM="
}

resource "openstack_networking_floatingip_v2" "jumphost-msp-float" {
  pool = "ext-net"
}

resource "openstack_compute_floatingip_associate_v2" "jumphost-msp-fip-ass" {
  floating_ip = openstack_networking_floatingip_v2.jumphost-msp-float.address
  instance_id = openstack_compute_instance_v2.jumphost-msp-vm.id
}

output "jumphost-fip" {
  value = openstack_compute_floatingip_associate_v2.jumphost-msp-fip-ass.floating_ip
}

output "jumphost-subnet-id" {
  value = "e06323d7-ba2e-4afd-bf7d-adcb4fc2a809"
}
</code></pre><p>auch im Modul muss die Datei <a href="http://versions.tf" target="_blank" rel="noopener">versions.tf</a> enthalten sein</p><h3 id="√Ñnderungen-am-Projekt"><a class="anchor hidden-xs" href="#√Ñnderungen-am-Projekt" title="√Ñnderungen-am-Projekt"><i class="fa fa-link"></i></a>√Ñnderungen am Projekt:</h3><p><a href="http://network.tf" target="_blank" rel="noopener">network.tf</a>:</p><pre><code>resource "openstack_networking_network_v2" "msp-net" {
  name           = "MSP Network"
  admin_state_up = true
}

resource "openstack_networking_subnet_v2" "msp-subnet" {
  name       = "MSP Subnet"
  ip_version = 4
  cidr       = var.cidr
  network_id = openstack_networking_network_v2.msp-net.id
}

resource "openstack_networking_port_v2" "msp-port" {
  name           = "msp-port"
  network_id     = openstack_networking_network_v2.msp-net.id
  admin_state_up = "true"

  fixed_ip {
    subnet_id = openstack_networking_subnet_v2.msp-subnet.id
  }
}
</code></pre><p><a href="http://null.tf" target="_blank" rel="noopener">null.tf</a>:</p><pre><code>resource "time_sleep" "wait_20_seconds" {
  depends_on = [module.jumphost]
  create_duration = "20s"
}

resource "null_resource" "remote-command" {
  depends_on = [time_sleep.wait_20_seconds]

  provisioner "remote-exec" {
    inline = ["echo 'ich bin ein remote provisioner' &gt; /tmp/provisioner.txt"]
    connection {
      type        = "ssh"
      user        = "debian"
      private_key = file("/home/tux/.ssh/id_rsa")
      #     private_key = file("/root/.ssh/id_rsa")   &lt;== f√ºr diejenigen, die mit root arbeiten
      host = module.jumphost.jumphost-fip
    }
  }
}

resource "null_resource" "local-command" {
  depends_on = [openstack_compute_instance_v2.msp-vm]
  provisioner "local-exec" {
    command = "echo '${openstack_compute_instance_v2.msp-vm.0.access_ip_v4}' &gt; ips.txt"
  }
}
</code></pre><p>neue Datei: <a href="http://main.tf" target="_blank" rel="noopener">main.tf</a></p><pre><code>module "jumphost" {
  source          = "../../modules/jumphost"
  jumphost_flavor = var.flavor
  jumphost_port_id = openstack_networking_port_v2.msp-port.id
}
</code></pre><h1 id="Tag-3---Ansible"><a class="anchor hidden-xs" href="#Tag-3---Ansible" title="Tag-3---Ansible"><i class="fa fa-link"></i></a>Tag 3 - Ansible</h1><h2 id="Installation1"><a class="anchor hidden-xs" href="#Installation1" title="Installation1"><i class="fa fa-link"></i></a>Installation</h2><pre><code>sudo apt update
sudo apt install ansible-core
</code></pre><p>√úberpr√ºfung:</p><pre><code>ansible --version
</code></pre><h2 id="Arbeitsverzeichnis-einrichten"><a class="anchor hidden-xs" href="#Arbeitsverzeichnis-einrichten" title="Arbeitsverzeichnis-einrichten"><i class="fa fa-link"></i></a>Arbeitsverzeichnis einrichten</h2><pre><code>cd
mkdir ansible
cd ansible
</code></pre><h2 id="Inventory"><a class="anchor hidden-xs" href="#Inventory" title="Inventory"><i class="fa fa-link"></i></a>Inventory</h2><p>neue Datei: inventory</p><pre><code>debian1
debian2
ubuntu1
ubuntu2
redhat1
redhat2
suse1
suse2
</code></pre><h2 id="ssh-einrichten"><a class="anchor hidden-xs" href="#ssh-einrichten" title="ssh-einrichten"><i class="fa fa-link"></i></a>ssh einrichten</h2><p>Falls noch kein ssh-key existiert (vorher als root gearbeitet) muss noch einer generiert werden:</p><pre><code>ssh-keygen
</code></pre><p>Key auf die Server verteilen:</p><pre><code>for i in ubuntu1 ubuntu2 suse1 suse2 redhat1 redhat2 debian1 debian2; do ssh-copy-id tux@$i; done
</code></pre><p>und dann abwechselnd yes (hostkey) eintippen und das Passwort f√ºr den Benutzer Tux (b1s)</p><h3 id="Test-der-Verbindung"><a class="anchor hidden-xs" href="#Test-der-Verbindung" title="Test-der-Verbindung"><i class="fa fa-link"></i></a>Test der Verbindung</h3><pre><code>ansible -i inventory all -m ping
</code></pre><p>jetzt muss alles gr√ºn sein (bis auf Warnings, die wir ignorieren ;) )</p><h2 id="Inventory-mit-Gruppen"><a class="anchor hidden-xs" href="#Inventory-mit-Gruppen" title="Inventory-mit-Gruppen"><i class="fa fa-link"></i></a>Inventory mit Gruppen</h2><pre><code>debian1
debian2
ubuntu1
ubuntu2
redhat1
redhat2
suse1
suse2

[debian]
debian1
debian2

[ubuntu]
ubuntu1
ubuntu2

[redhat]
redhat1
redhat2

[suse]
suse1
suse2
</code></pre><h2 id="sudo-im-ansible-Kontext"><a class="anchor hidden-xs" href="#sudo-im-ansible-Kontext" title="sudo-im-ansible-Kontext"><i class="fa fa-link"></i></a>sudo im ansible Kontext</h2><p>Ansible braucht f√ºr viele Aktionen sudo-Rechte. Dazu gibt es bei einem ad-hoc Kommando den Schalter <code>--become</code> oder in Kurzform <code>-b</code></p><h3 id="L√∂sung-Folie-145"><a class="anchor hidden-xs" href="#L√∂sung-Folie-145" title="L√∂sung-Folie-145"><i class="fa fa-link"></i></a>L√∂sung Folie 145</h3><p>Aufage 1: wird nicht gemacht (deprecated)<br>
Aufgabe 2:</p><pre><code>ansible -i inventory ubuntu,suse1 -m ansible.builtin.user -a "name=markus shell=/bin/bash" -b
</code></pre><p>Aufgabe 3:</p><pre><code>ansible redhat -i inventory -m ansible.builtin.setup -a "filter=ansible_eth0"
</code></pre><h2 id="Collection-installieren-und-auflisten"><a class="anchor hidden-xs" href="#Collection-installieren-und-auflisten" title="Collection-installieren-und-auflisten"><i class="fa fa-link"></i></a>Collection installieren und auflisten</h2><pre><code>ansible-galaxy collection install ansible.posix
</code></pre><pre><code>ansible-galaxy collection list
</code></pre><h2 id="Playbooks"><a class="anchor hidden-xs" href="#Playbooks" title="Playbooks"><i class="fa fa-link"></i></a>Playbooks</h2><h3 id="das-erste-Playbook"><a class="anchor hidden-xs" href="#das-erste-Playbook" title="das-erste-Playbook"><i class="fa fa-link"></i></a>das erste Playbook</h3><pre><code>---
- name: First playbook
  hosts: all
  become: true
  tasks:
   - name: Ensure that the directory /home/tux/foo is present
      ansible.builtin.file:
        path: /home/tux/foo
        owner: tux
        mode: "0755"
        state: directory 
</code></pre><p>Aufruf des playbooks:</p><pre><code>ansible-playbook -i inventory playbook1.yml
</code></pre><h2 id="Exkurs-yamllint"><a class="anchor hidden-xs" href="#Exkurs-yamllint" title="Exkurs-yamllint"><i class="fa fa-link"></i></a>Exkurs: yamllint</h2><pre><code>sudo apt install yamllint
</code></pre><h2 id="Konfiguration-von-Ansible"><a class="anchor hidden-xs" href="#Konfiguration-von-Ansible" title="Konfiguration-von-Ansible"><i class="fa fa-link"></i></a>Konfiguration von Ansible</h2><pre><code>cd ~/ansible
ansible-config init --disabled &gt; ansible.cfg
</code></pre><p>Jetzt kann man dann mit einem Editor die Datei anpassen und damit ansible konfigurieren.<br>
In Zeile 137 setzen wir:</p><pre><code>inventory=/home/tux/ansible/inventory
</code></pre><h2 id="L√∂sung-Folie-182"><a class="anchor hidden-xs" href="#L√∂sung-Folie-182" title="L√∂sung-Folie-182"><i class="fa fa-link"></i></a>L√∂sung Folie 182</h2><pre><code>---
- name: ensure some software
  become: true
  hosts: all
  tasks:
    - name: ensure git present on ubuntu1 and suse2
      ansible.builtin.package:
        name: git
        state: present
      when: ansible_hostname == "ubuntu1" or ansible_hostname == "suse2"
    - name: ensure package curl on non Suse ans non Debian family hosts
      ansible.builtin.package:
        name: curl
        state: present
      when: ansible_os_family != "Suse" and ansible_os_family != "Debian"
</code></pre><h1 id="Tag-4"><a class="anchor hidden-xs" href="#Tag-4" title="Tag-4"><i class="fa fa-link"></i></a>Tag 4</h1><h2 id="√úbung-zu-loop-und-registered-variable"><a class="anchor hidden-xs" href="#√úbung-zu-loop-und-registered-variable" title="√úbung-zu-loop-und-registered-variable"><i class="fa fa-link"></i></a>√úbung zu loop und registered variable</h2><pre><code>---
- name: example for registered variable and a loop
  hosts: suse
  tasks:
    - name: create count variable
      ansible.builtin.command:
        cmd: "seq 1 20"
      register: counter
    - name: show counter variable
      ansible.builtin.debug:
        var: "counter"
    - name: create dirs in /tmp
      ansible.builtin.file:
        path: "/tmp/dir{{ item }}"
        state: directory
        owner: tux
        mode: "0755"
      loop: "{{ counter.stdout_lines }}"
</code></pre><h2 id="ansible-Verzeichnis-aufr√§umen-und-Standard-Ornderstruktur-anlegen"><a class="anchor hidden-xs" href="#ansible-Verzeichnis-aufr√§umen-und-Standard-Ornderstruktur-anlegen" title="ansible-Verzeichnis-aufr√§umen-und-Standard-Ornderstruktur-anlegen"><i class="fa fa-link"></i></a>ansible-Verzeichnis aufr√§umen und Standard Ornderstruktur anlegen</h2><pre><code>cd ~/ansible
mkdir playbooks
mkdir roles
mv *.yml playbooks
</code></pre><p>ggfs noch √ºberfl√ºssige Dateien wegr√§umen ;)</p><h2 id="Playbook-zum-Erzeugen-einer-Rollenstruktur-customized-statt-ansible-galaxy-init"><a class="anchor hidden-xs" href="#Playbook-zum-Erzeugen-einer-Rollenstruktur-customized-statt-ansible-galaxy-init" title="Playbook-zum-Erzeugen-einer-Rollenstruktur-customized-statt-ansible-galaxy-init"><i class="fa fa-link"></i></a>Playbook zum Erzeugen einer Rollenstruktur (customized) statt ansible-galaxy init</h2><pre><code>---
- name: Standard playbook to create customized role structure
  hosts: localhost
  vars:
    roledir: "/home/tux/ansible/roles"
    rolename: "default"
    directories:
      - tasks
      - vars
      - defaults
      - files
      - templates
      - meta
      - handlers
  tasks:
    - name: create roledirs
      ansible.builtin.file:
        path: "{{ roledir }}/{{ rolename }}/{{ item }}"
        state: directory
        owner: tux
        mode: "0755"
      loop: "{{ directories }}"
    - name: create main.yml where needed
      ansible.builtin.file:
        path: "{{ roledir }}/{{ rolename }}/{{ item }}/main.yml"
        state: touch
        owner: tux
        mode: "0644"
      loop: "{{ directories }}"
      when: item in ['tasks', 'vars', 'defaults', 'meta', 'handlers']
    - name: fill main.yml with my standards
      ansible.builtin.lineinfile:
        path: "{{ roledir }}/{{ rolename }}/{{ item }}/main.yml"
        state: present
        line: "---"
      loop: "{{ directories }}"
      when: item in ['tasks', 'vars', 'defaults', 'meta', 'handlers'] 
</code></pre><p>Aufruf dann wie folgt:</p><pre><code>ansible-playbook playbooks/create_role.yml -e rolename=apache -e roledir=/home/tux/test/roles
</code></pre><h1 id="Tag-5-Projekt-TLRZ"><a class="anchor hidden-xs" href="#Tag-5-Projekt-TLRZ" title="Tag-5-Projekt-TLRZ"><i class="fa fa-link"></i></a>Tag 5: Projekt TLRZ</h1><p>auf dem ansible-controller</p><pre><code>cd
mkdir tlrz-project
cd tlrz-project
cp ../terraform/workspace/project1/versions.tf .
terraform init
source ~/openrc.sh
</code></pre><h2 id="Terraform"><a class="anchor hidden-xs" href="#Terraform" title="Terraform"><i class="fa fa-link"></i></a>Terraform</h2><p><a href="http://server.tf" target="_blank" rel="noopener">server.tf</a>:</p><pre><code>resource "openstack_compute_instance_v2" "frontend" {
  name        = "MSP Webserver Frontend"
  image_name  = "Debian 12 Bookworm x86_64"
  flavor_name = "1C-1GB-20GB"
  key_pair    = "MSP"
  network {
    name = "net-to-external"
  }
}

resource "openstack_compute_instance_v2" "backend" {
  name        = "MSP Database Backend"
  image_name  = "Debian 12 Bookworm x86_64"
  flavor_name = "2C-2GB-20GB"
  key_pair    = "MSP"
  network {
    name = "net-to-external"
  }
}

resource "openstack_compute_keypair_v2" "msp-key" {
  name       = "MSP"
  public_key = "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDPI5nnVAffaClCbkX0yhfHnB+tBg5jKMVwXTjLByzIk6HTtQPnocltv2+0HC3eFkbVs4zq/XeUS6riBXbT9HKmzz3853vh19K9G8wVRNxJZmvWNdZ1c/+pApcVOGm+/OBhivFg+U4727KDONqJgpD4X3QjfrLsK8w3dXLevzZxDNxJgiNzK7gOVIqunTINceIDybSjHgllhepeIGmHhf4qv6zoNfClJtmLWulYZh0NRiMApILq0sN7t30jFXHB9Kyxctumst7lVn0E9ovjpAXiiYeIkFyIZAcQf4OGlqbAj+5Octis4msDpc+wHhOiq+LAxPnxmsFfsiWL94CbeUgsKRUTjiY1sRyWTFD6YNln0yHaZzxUD3toMeq2Xft+8zKleb5IgS+kuDrL8HZnRvN5pI2CvcwNwTMydmcivXZg8U21z1cuBUReitL+JwzTU/OkDyUg9ZMBuvm7CfXLSH9T/Mwsrlsd5HvPuoSaD5dqEz7v4dnUyP79nw82gSFCofM="
}

resource "openstack_blockstorage_volume_v3" "database-vol" {
  name = "MSP database disk"
  size = 20
}

resource "openstack_compute_volume_attach_v2" "database_att" {
  instance_id = openstack_compute_instance_v2.backend.id
  volume_id   = openstack_blockstorage_volume_v3.database-vol.id
}
</code></pre><p><a href="http://network.tf" target="_blank" rel="noopener">network.tf</a></p><pre><code>resource "openstack_networking_floatingip_v2" "fip_front" {
  pool = "ext-net"
}

resource "openstack_compute_floatingip_associate_v2" "fip_front_ass" {
  instance_id = openstack_compute_instance_v2.frontend.id
  floating_ip = openstack_networking_floatingip_v2.fip_front.address
}

resource "openstack_networking_floatingip_v2" "fip_back" {
  pool = "ext-net"
}

resource "openstack_compute_floatingip_associate_v2" "fip_back_ass" {
  instance_id = openstack_compute_instance_v2.backend.id
  floating_ip = openstack_networking_floatingip_v2.fip_back.address
}
</code></pre><p><a href="http://null.tf" target="_blank" rel="noopener">null.tf</a></p><pre><code>resource "null_resource" "backend" {
  depends_on = [openstack_compute_floatingip_associate_v2.fip_back_ass,
  openstack_compute_instance_v2.backend]
  # wait for connectivity
  provisioner "remote-exec" {
    inline = ["sudo cloud-init status --wait"]
    connection {
      type        = "ssh"
      user        = "debian"
      host        = openstack_compute_floatingip_associate_v2.fip_back_ass.floating_ip
      private_key = file("/home/tux/.ssh/id_rsa")
    }
  }

  provisioner "local-exec" {
    command = "ansible-playbook -u 'debian' -i '${openstack_compute_floatingip_associate_v2.fip_back_ass.floating_ip},' --ssh-common-args='-o StrictHostKeyChecking=no' main.yml -t backend -t common"
  }
}

resource "null_resource" "frontend" {
  depends_on = [openstack_compute_floatingip_associate_v2.fip_front_ass,
  openstack_compute_instance_v2.backend]

  # wait for connectivity
  provisioner "remote-exec" {
    inline = ["sudo cloud-init status --wait"]
    connection {
      type        = "ssh"
      user        = "debian"
      host        = openstack_compute_floatingip_associate_v2.fip_front_ass.floating_ip
      private_key = file("/home/tux/.ssh/id_rsa")
    }
  }

  provisioner "local-exec" {
    command = "ansible-playbook -u 'debian' -i '${openstack_compute_floatingip_associate_v2.fip_front_ass.floating_ip},' --ssh-common-args='-o StrictHostKeyChecking=no' main.yml -t frontend -t common"
  }
}
</code></pre><h2 id="Ansible"><a class="anchor hidden-xs" href="#Ansible" title="Ansible"><i class="fa fa-link"></i></a>Ansible</h2><p>im Projektordner:</p><pre><code>mkdir roles
cd roles
ansible-galaxy init common
ansible-galaxy init database
ansible-galaxy init webserver
</code></pre><p>Playbook main.yml</p><pre><code>---
- hosts: all
  become: true
  roles:
    - common
    - database
    - webserver
</code></pre><h3 id="Rolle-common"><a class="anchor hidden-xs" href="#Rolle-common" title="Rolle-common"><i class="fa fa-link"></i></a>Rolle common</h3><p>roles/common/tasks/main.yml</p><pre><code>---
- name: common tasks for all servers
  tags: common
  block:
    - name: wait for connection
      ansible.builtin.ping: {}
      register: pingresult
      until: pingresult['failed'] == false
      retries: 10
      delay: 5

    - name: create service user
      ansible.builtin.user:
        name: service
        generate_ssh_key: true
        home: /opt/service
        shell: /bin/bash
        system: true

    - name: install standard software packages
      ansible.builtin.apt:
        update_cache: true
        name:
          - curl
          - htop
          - cowsay
          - fortune
          - nano
        state: latest
</code></pre><h3 id="Rolle-database"><a class="anchor hidden-xs" href="#Rolle-database" title="Rolle-database"><i class="fa fa-link"></i></a>Rolle database</h3><p>roles/database/tasks/main.yml</p><pre><code>---
- name: create the database backend
  tags: backend
  block:
    - name: install mariadb
      ansible.builtin.apt:
        update_cache: true
        name: mariadb-server
        state: present
    - name: configure mariadb
      ansible.builtin.template:
        src: 50-server.cnf.j2
        dest: /etc/mysql/mariadb.conf.d/50-server.cnf
        owner: root
        group: root
        mode: "0644"
      notify: restart mariadb
</code></pre><p>roles/database/handlers/main.yml</p><pre><code>---
- name: restart mariadb
  ansible.builtin.service:
    name: mariadb
    state: restarted
</code></pre><p>roles/database/vars/main.yml</p><pre><code>---
db_local_only: false
backend_ip: 0.0.0.0
</code></pre><p>roles/database/templates/50-server.cnf.j2</p><pre><code>[server]
[mysqld]
pid-file                = /run/mysqld/mysqld.pid
basedir                 = /usr
{% if db_local_only %} 
bind-address            = 127.0.0.1
{% else %}
bind-address            = {{ backend_ip }}
{% endif %}
expire_logs_days        = 10
character-set-server  = utf8mb4
collation-server      = utf8mb4_general_ci
[embedded]
[mariadb]
[mariadb-10.11]
</code></pre><h3 id="Rolle-webserver"><a class="anchor hidden-xs" href="#Rolle-webserver" title="Rolle-webserver"><i class="fa fa-link"></i></a>Rolle webserver</h3><p>roles/webserver/tasks/main.yml</p><pre><code>---
- name: create the frontend
  tags: frontend
  block:
    - name: install nginx
      ansible.builtin.apt:
        update_cache: true
        name: nginx
        state: present
    - name: configure nginx
      ansible.builtin.copy:
        src: nginx.conf
        dest: /etc/nginx/nginx.conf
        owner: root
        group: root
        mode: "0644"
      notify: restart nginx
    - name: remove default vhost
      ansible.builtin.file:
        path: /etc/nginx/{{ item }}/default
        state: absent
      loop:
        - sites-enabled
        - sites-available
      notify: restart nginx
    - name: configure vhost
      ansible.builtin.template:
        src: tlrz.de.j2
        dest: /etc/nginx/sites-available/{{ servername }}
        owner: root
        group: root
        mode: "0644"
      notify: restart nginx
    - name: enable the site
      ansible.builtin.file:
        path: /etc/nginx/sites-enabled/{{ servername }}
        src: /etc/nginx/sites-available/{{ servername }}
        state: link
        owner: root
        group: root
        mode: "0644"
      notify: restart nginx
</code></pre><p>roles/webserver/handlers/main.yml</p><pre><code>---
- name: restart nginx
  ansible.builtin.service:
    name: nginx
    state: restarted
</code></pre><p>roles/webserver/files/nginx.conf</p><pre><code>user www-data;
worker_processes auto;
pid /run/nginx.pid;
error_log /var/log/nginx/error.log;
include /etc/nginx/modules-enabled/*.conf;
events {
	worker_connections 512;
}
http {
	sendfile on;
	tcp_nopush on;
	types_hash_max_size 2048;
	include /etc/nginx/mime.types;
	default_type application/octet-stream;
	ssl_prefer_server_ciphers on;
	access_log /var/log/nginx/access.log;
	gzip on;
	include /etc/nginx/conf.d/*.conf;
	include /etc/nginx/sites-enabled/*;
}
</code></pre><p>roles/webserver/templates/tlrz.de.j2</p><pre><code>server {
	listen 80 default_server;
	listen [::]:80 default_server;
	root /var/www/html;
	index index.html;
	server_name {{ servername }};
	location / {
		try_files $uri $uri/ =404;
	}
}
</code></pre><p>roles/webserver/vars/main.yml</p><pre><code>---
servername: tlrz.de
</code></pre></div>
    <div class="ui-toc dropup unselectable hidden-print" style="display:none;">
        <div class="pull-right dropdown">
            <a id="tocLabel" class="ui-toc-label btn btn-default" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false" title="Table of content">
                <i class="fa fa-bars"></i>
            </a>
            <ul id="ui-toc" class="ui-toc-dropdown dropdown-menu" aria-labelledby="tocLabel">
                <div class="toc"><ul class="nav">
<li class=""><a href="#Terraform-amp-Ansible-f√ºr-TLRZ" title="Terraform &amp; Ansible f√ºr TLRZ">Terraform &amp; Ansible f√ºr TLRZ</a><ul class="nav">
<li><a href="#Trainer" title="Trainer:">Trainer:</a></li>
<li class=""><a href="#Schulungsumgebung" title="Schulungsumgebung">Schulungsumgebung</a><ul class="nav">
<li class=""><a href="#Zugriff-√ºber-Web-RDP-Guacamole" title="Zugriff √ºber Web-RDP (Guacamole):">Zugriff √ºber Web-RDP (Guacamole):</a></li>
<li><a href="#Zugriff-√ºber-SSH" title="Zugriff √ºber SSH:">Zugriff √ºber SSH:</a></li>
<li class=""><a href="#Zugriff-vom-Jumphost-auf-die-einzelnen-Maschinen" title="Zugriff vom Jumphost auf die einzelnen Maschinen:">Zugriff vom Jumphost auf die einzelnen Maschinen:</a></li>
</ul>
</li>
</ul>
</li>
<li class=""><a href="#Tag-1" title="Tag 1">Tag 1</a></li>
<li class=""><a href="#Terraform0" title="Terraform">Terraform</a><ul class="nav">
<li><a href="#Installation" title="Installation">Installation</a><ul class="nav">
<li><a href="#Repo-einrichten-Debian" title="Repo einrichten (Debian)">Repo einrichten (Debian)</a></li>
<li><a href="#Terraform-installieren" title="Terraform installieren">Terraform installieren</a></li>
</ul>
</li>
<li class=""><a href="#Projekt-initialisieren" title="Projekt initialisieren">Projekt initialisieren</a></li>
<li class=""><a href="#Provider-konfigurieren" title="Provider konfigurieren">Provider konfigurieren</a></li>
<li class=""><a href="#Eine-erste-Resource-VM" title="Eine erste Resource (VM):">Eine erste Resource (VM):</a><ul class="nav">
<li><a href="#Erweiterung-auf-3-gleiche-VMs" title="Erweiterung auf 3 gleiche VMs">Erweiterung auf 3 gleiche VMs</a></li>
<li class=""><a href="#Netzwerk-und-Subnet" title="Netzwerk und Subnet">Netzwerk und Subnet</a></li>
<li class=""><a href="#Erweiterung-um-Router-und-Floatingip" title="Erweiterung um Router und Floatingip">Erweiterung um Router und Floatingip</a></li>
<li class=""><a href="#Keypair-erzeugen" title="Keypair erzeugen">Keypair erzeugen</a></li>
<li class=""><a href="#Server-mit-keypair-erweitern" title="Server mit keypair erweitern">Server mit keypair erweitern</a></li>
</ul>
</li>
</ul>
</li>
<li class=""><a href="#Tag-2" title="Tag 2">Tag 2</a><ul class="nav">
<li class=""><a href="#Variablen" title="Variablen">Variablen</a></li>
<li class=""><a href="#Outputs" title="Outputs">Outputs</a></li>
<li class=""><a href="#Blockstorage" title="Blockstorage">Blockstorage</a></li>
<li class=""><a href="#Null-Resource-remote-und-local-exec" title="Null Resource (remote und local-exec)">Null Resource (remote und local-exec)</a></li>
<li class=""><a href="#Module" title="Module">Module</a><ul class="nav">
<li><a href="#Vorbereitung" title="Vorbereitung:">Vorbereitung:</a></li>
<li class=""><a href="#Modul" title="Modul">Modul</a></li>
<li class=""><a href="#√Ñnderungen-am-Projekt" title="√Ñnderungen am Projekt:">√Ñnderungen am Projekt:</a></li>
</ul>
</li>
</ul>
</li>
<li class=""><a href="#Tag-3---Ansible" title="Tag 3 - Ansible">Tag 3 - Ansible</a><ul class="nav">
<li><a href="#Installation1" title="Installation">Installation</a></li>
<li><a href="#Arbeitsverzeichnis-einrichten" title="Arbeitsverzeichnis einrichten">Arbeitsverzeichnis einrichten</a></li>
<li class=""><a href="#Inventory" title="Inventory">Inventory</a></li>
<li class=""><a href="#ssh-einrichten" title="ssh einrichten">ssh einrichten</a><ul class="nav">
<li class=""><a href="#Test-der-Verbindung" title="Test der Verbindung">Test der Verbindung</a></li>
</ul>
</li>
<li class=""><a href="#Inventory-mit-Gruppen" title="Inventory mit Gruppen">Inventory mit Gruppen</a></li>
<li class=""><a href="#sudo-im-ansible-Kontext" title="sudo im ansible Kontext">sudo im ansible Kontext</a><ul class="nav">
<li class=""><a href="#L√∂sung-Folie-145" title="L√∂sung Folie 145">L√∂sung Folie 145</a></li>
</ul>
</li>
<li><a href="#Collection-installieren-und-auflisten" title="Collection installieren und auflisten">Collection installieren und auflisten</a></li>
<li class=""><a href="#Playbooks" title="Playbooks">Playbooks</a><ul class="nav">
<li class=""><a href="#das-erste-Playbook" title="das erste Playbook">das erste Playbook</a></li>
</ul>
</li>
<li><a href="#Exkurs-yamllint" title="Exkurs: yamllint">Exkurs: yamllint</a></li>
<li class=""><a href="#Konfiguration-von-Ansible" title="Konfiguration von Ansible">Konfiguration von Ansible</a></li>
<li class=""><a href="#L√∂sung-Folie-182" title="L√∂sung Folie 182">L√∂sung Folie 182</a></li>
</ul>
</li>
<li class=""><a href="#Tag-4" title="Tag 4">Tag 4</a><ul class="nav">
<li class=""><a href="#√úbung-zu-loop-und-registered-variable" title="√úbung zu loop und registered variable">√úbung zu loop und registered variable</a></li>
<li><a href="#ansible-Verzeichnis-aufr√§umen-und-Standard-Ornderstruktur-anlegen" title="ansible-Verzeichnis aufr√§umen und Standard Ornderstruktur anlegen">ansible-Verzeichnis aufr√§umen und Standard Ornderstruktur anlegen</a></li>
<li class=""><a href="#Playbook-zum-Erzeugen-einer-Rollenstruktur-customized-statt-ansible-galaxy-init" title="Playbook zum Erzeugen einer Rollenstruktur (customized) statt ansible-galaxy init">Playbook zum Erzeugen einer Rollenstruktur (customized) statt ansible-galaxy init</a></li>
</ul>
</li>
<li class=""><a href="#Tag-5-Projekt-TLRZ" title="Tag 5: Projekt TLRZ">Tag 5: Projekt TLRZ</a><ul class="nav">
<li class=""><a href="#Terraform" title="Terraform">Terraform</a></li>
<li class=""><a href="#Ansible" title="Ansible">Ansible</a><ul class="nav">
<li class=""><a href="#Rolle-common" title="Rolle common">Rolle common</a></li>
<li class=""><a href="#Rolle-database" title="Rolle database">Rolle database</a></li>
<li class=""><a href="#Rolle-webserver" title="Rolle webserver">Rolle webserver</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div><div class="toc-menu"><a class="expand-toggle" href="#">Expand all</a><a class="back-to-top" href="#">Back to top</a><a class="go-to-bottom" href="#">Go to bottom</a></div>
            </ul>
        </div>
    </div>
    <div id="ui-toc-affix" class="ui-affix-toc ui-toc-dropdown unselectable hidden-print" data-spy="affix" style="top:17px;display:none;"  >
        <div class="toc"><ul class="nav">
<li class=""><a href="#Terraform-amp-Ansible-f√ºr-TLRZ" title="Terraform &amp; Ansible f√ºr TLRZ">Terraform &amp; Ansible f√ºr TLRZ</a><ul class="nav">
<li><a href="#Trainer" title="Trainer:">Trainer:</a></li>
<li class=""><a href="#Schulungsumgebung" title="Schulungsumgebung">Schulungsumgebung</a><ul class="nav">
<li class=""><a href="#Zugriff-√ºber-Web-RDP-Guacamole" title="Zugriff √ºber Web-RDP (Guacamole):">Zugriff √ºber Web-RDP (Guacamole):</a></li>
<li><a href="#Zugriff-√ºber-SSH" title="Zugriff √ºber SSH:">Zugriff √ºber SSH:</a></li>
<li class=""><a href="#Zugriff-vom-Jumphost-auf-die-einzelnen-Maschinen" title="Zugriff vom Jumphost auf die einzelnen Maschinen:">Zugriff vom Jumphost auf die einzelnen Maschinen:</a></li>
</ul>
</li>
</ul>
</li>
<li class=""><a href="#Tag-1" title="Tag 1">Tag 1</a></li>
<li class=""><a href="#Terraform0" title="Terraform">Terraform</a><ul class="nav">
<li><a href="#Installation" title="Installation">Installation</a><ul class="nav">
<li><a href="#Repo-einrichten-Debian" title="Repo einrichten (Debian)">Repo einrichten (Debian)</a></li>
<li><a href="#Terraform-installieren" title="Terraform installieren">Terraform installieren</a></li>
</ul>
</li>
<li class=""><a href="#Projekt-initialisieren" title="Projekt initialisieren">Projekt initialisieren</a></li>
<li class=""><a href="#Provider-konfigurieren" title="Provider konfigurieren">Provider konfigurieren</a></li>
<li class=""><a href="#Eine-erste-Resource-VM" title="Eine erste Resource (VM):">Eine erste Resource (VM):</a><ul class="nav">
<li><a href="#Erweiterung-auf-3-gleiche-VMs" title="Erweiterung auf 3 gleiche VMs">Erweiterung auf 3 gleiche VMs</a></li>
<li class=""><a href="#Netzwerk-und-Subnet" title="Netzwerk und Subnet">Netzwerk und Subnet</a></li>
<li class=""><a href="#Erweiterung-um-Router-und-Floatingip" title="Erweiterung um Router und Floatingip">Erweiterung um Router und Floatingip</a></li>
<li class=""><a href="#Keypair-erzeugen" title="Keypair erzeugen">Keypair erzeugen</a></li>
<li class=""><a href="#Server-mit-keypair-erweitern" title="Server mit keypair erweitern">Server mit keypair erweitern</a></li>
</ul>
</li>
</ul>
</li>
<li class=""><a href="#Tag-2" title="Tag 2">Tag 2</a><ul class="nav">
<li class=""><a href="#Variablen" title="Variablen">Variablen</a></li>
<li class=""><a href="#Outputs" title="Outputs">Outputs</a></li>
<li class=""><a href="#Blockstorage" title="Blockstorage">Blockstorage</a></li>
<li class=""><a href="#Null-Resource-remote-und-local-exec" title="Null Resource (remote und local-exec)">Null Resource (remote und local-exec)</a></li>
<li class=""><a href="#Module" title="Module">Module</a><ul class="nav">
<li><a href="#Vorbereitung" title="Vorbereitung:">Vorbereitung:</a></li>
<li class=""><a href="#Modul" title="Modul">Modul</a></li>
<li class=""><a href="#√Ñnderungen-am-Projekt" title="√Ñnderungen am Projekt:">√Ñnderungen am Projekt:</a></li>
</ul>
</li>
</ul>
</li>
<li class=""><a href="#Tag-3---Ansible" title="Tag 3 - Ansible">Tag 3 - Ansible</a><ul class="nav">
<li><a href="#Installation1" title="Installation">Installation</a></li>
<li><a href="#Arbeitsverzeichnis-einrichten" title="Arbeitsverzeichnis einrichten">Arbeitsverzeichnis einrichten</a></li>
<li class=""><a href="#Inventory" title="Inventory">Inventory</a></li>
<li class=""><a href="#ssh-einrichten" title="ssh einrichten">ssh einrichten</a><ul class="nav">
<li class=""><a href="#Test-der-Verbindung" title="Test der Verbindung">Test der Verbindung</a></li>
</ul>
</li>
<li class=""><a href="#Inventory-mit-Gruppen" title="Inventory mit Gruppen">Inventory mit Gruppen</a></li>
<li class=""><a href="#sudo-im-ansible-Kontext" title="sudo im ansible Kontext">sudo im ansible Kontext</a><ul class="nav">
<li class=""><a href="#L√∂sung-Folie-145" title="L√∂sung Folie 145">L√∂sung Folie 145</a></li>
</ul>
</li>
<li><a href="#Collection-installieren-und-auflisten" title="Collection installieren und auflisten">Collection installieren und auflisten</a></li>
<li class=""><a href="#Playbooks" title="Playbooks">Playbooks</a><ul class="nav">
<li class=""><a href="#das-erste-Playbook" title="das erste Playbook">das erste Playbook</a></li>
</ul>
</li>
<li><a href="#Exkurs-yamllint" title="Exkurs: yamllint">Exkurs: yamllint</a></li>
<li class=""><a href="#Konfiguration-von-Ansible" title="Konfiguration von Ansible">Konfiguration von Ansible</a></li>
<li class=""><a href="#L√∂sung-Folie-182" title="L√∂sung Folie 182">L√∂sung Folie 182</a></li>
</ul>
</li>
<li class=""><a href="#Tag-4" title="Tag 4">Tag 4</a><ul class="nav">
<li class=""><a href="#√úbung-zu-loop-und-registered-variable" title="√úbung zu loop und registered variable">√úbung zu loop und registered variable</a></li>
<li><a href="#ansible-Verzeichnis-aufr√§umen-und-Standard-Ornderstruktur-anlegen" title="ansible-Verzeichnis aufr√§umen und Standard Ornderstruktur anlegen">ansible-Verzeichnis aufr√§umen und Standard Ornderstruktur anlegen</a></li>
<li class=""><a href="#Playbook-zum-Erzeugen-einer-Rollenstruktur-customized-statt-ansible-galaxy-init" title="Playbook zum Erzeugen einer Rollenstruktur (customized) statt ansible-galaxy init">Playbook zum Erzeugen einer Rollenstruktur (customized) statt ansible-galaxy init</a></li>
</ul>
</li>
<li class=""><a href="#Tag-5-Projekt-TLRZ" title="Tag 5: Projekt TLRZ">Tag 5: Projekt TLRZ</a><ul class="nav">
<li class=""><a href="#Terraform" title="Terraform">Terraform</a></li>
<li class=""><a href="#Ansible" title="Ansible">Ansible</a><ul class="nav">
<li class=""><a href="#Rolle-common" title="Rolle common">Rolle common</a></li>
<li class=""><a href="#Rolle-database" title="Rolle database">Rolle database</a></li>
<li class=""><a href="#Rolle-webserver" title="Rolle webserver">Rolle webserver</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div><div class="toc-menu"><a class="expand-toggle" href="#">Expand all</a><a class="back-to-top" href="#">Back to top</a><a class="go-to-bottom" href="#">Go to bottom</a></div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.0/js/bootstrap.min.js" integrity="sha256-kJrlY+s09+QoWjpkOrXXwhxeaoDz9FW5SaxF8I0DibQ=" crossorigin="anonymous" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gist-embed/2.6.0/gist-embed.min.js" integrity="sha256-KyF2D6xPIJUW5sUDSs93vWyZm+1RzIpKCexxElmxl8g=" crossorigin="anonymous" defer></script>
    <script>
        var markdown = $(".markdown-body");
        //smooth all hash trigger scrolling
        function smoothHashScroll() {
            var hashElements = $("a[href^='#']").toArray();
            for (var i = 0; i < hashElements.length; i++) {
                var element = hashElements[i];
                var $element = $(element);
                var hash = element.hash;
                if (hash) {
                    $element.on('click', function (e) {
                        // store hash
                        var hash = this.hash;
                        if ($(hash).length <= 0) return;
                        // prevent default anchor click behavior
                        e.preventDefault();
                        // animate
                        $('body, html').stop(true, true).animate({
                            scrollTop: $(hash).offset().top
                        }, 100, "linear", function () {
                            // when done, add hash to url
                            // (default click behaviour)
                            window.location.hash = hash;
                        });
                    });
                }
            }
        }

        smoothHashScroll();
        var toc = $('.ui-toc');
        var tocAffix = $('.ui-affix-toc');
        var tocDropdown = $('.ui-toc-dropdown');
        //toc
        tocDropdown.click(function (e) {
            e.stopPropagation();
        });

        var enoughForAffixToc = true;

        function generateScrollspy() {
            $(document.body).scrollspy({
                target: ''
            });
            $(document.body).scrollspy('refresh');
            if (enoughForAffixToc) {
                toc.hide();
                tocAffix.show();
            } else {
                tocAffix.hide();
                toc.show();
            }
            $(document.body).scroll();
        }

        function windowResize() {
            //toc right
            var paddingRight = parseFloat(markdown.css('padding-right'));
            var right = ($(window).width() - (markdown.offset().left + markdown.outerWidth() - paddingRight));
            toc.css('right', right + 'px');
            //affix toc left
            var newbool;
            var rightMargin = (markdown.parent().outerWidth() - markdown.outerWidth()) / 2;
            //for ipad or wider device
            if (rightMargin >= 133) {
                newbool = true;
                var affixLeftMargin = (tocAffix.outerWidth() - tocAffix.width()) / 2;
                var left = markdown.offset().left + markdown.outerWidth() - affixLeftMargin;
                tocAffix.css('left', left + 'px');
            } else {
                newbool = false;
            }
            if (newbool != enoughForAffixToc) {
                enoughForAffixToc = newbool;
                generateScrollspy();
            }
        }
        $(window).resize(function () {
            windowResize();
        });
        $(document).ready(function () {
            windowResize();
            generateScrollspy();
        });

        //remove hash
        function removeHash() {
            window.location.hash = '';
        }

        var backtotop = $('.back-to-top');
        var gotobottom = $('.go-to-bottom');

        backtotop.click(function (e) {
            e.preventDefault();
            e.stopPropagation();
            if (scrollToTop)
                scrollToTop();
            removeHash();
        });
        gotobottom.click(function (e) {
            e.preventDefault();
            e.stopPropagation();
            if (scrollToBottom)
                scrollToBottom();
            removeHash();
        });

        var toggle = $('.expand-toggle');
        var tocExpand = false;

        checkExpandToggle();
        toggle.click(function (e) {
            e.preventDefault();
            e.stopPropagation();
            tocExpand = !tocExpand;
            checkExpandToggle();
        })

        function checkExpandToggle () {
            var toc = $('.ui-toc-dropdown .toc');
            var toggle = $('.expand-toggle');
            if (!tocExpand) {
                toc.removeClass('expand');
                toggle.text('Expand all');
            } else {
                toc.addClass('expand');
                toggle.text('Collapse all');
            }
        }

        function scrollToTop() {
            $('body, html').stop(true, true).animate({
                scrollTop: 0
            }, 100, "linear");
        }

        function scrollToBottom() {
            $('body, html').stop(true, true).animate({
                scrollTop: $(document.body)[0].scrollHeight
            }, 100, "linear");
        }
    </script>
</body>

</html>
